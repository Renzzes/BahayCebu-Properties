# Enable rewrite engine
RewriteEngine On

# Set base directory
RewriteBase /

# Enable CORS for API subdomain
<IfModule mod_headers.c>
    # Always set these headers for all responses
    Header always set Access-Control-Allow-Origin "https://bahaycebu-properties.com"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, Accept"
    Header always set Access-Control-Allow-Credentials "true"
    
    # Add additional origins if needed
    # SetEnvIf Origin "^http(s)?://(.+\.)?localhost:\d+$" CORS_ORIGIN=$0
    # Header always set Access-Control-Allow-Origin %{CORS_ORIGIN}e env=CORS_ORIGIN
    
    # Handle preflight OPTIONS requests
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# Force content type for API responses
<IfModule mod_headers.c>
    # Set JSON content type for API responses
    Header set Content-Type "application/json" env=API_RESPONSE
</IfModule>

# Set environment variable for API responses
<IfModule mod_rewrite.c>
    RewriteRule ^api/ - [E=API_RESPONSE:1]
</IfModule>

# Enable gzip compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
</IfModule>